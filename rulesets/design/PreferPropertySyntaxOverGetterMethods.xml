<?xml version="1.0" ?>
<ruleset
	name="Apex Design Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>
		Custom rules for Apex design issues (structure, method signatures, class
		organization)
	</description>
	<rule
		name="PreferPropertySyntaxOverGetterMethods"
		language="apex"
		message="Private fields with public getter methods should be replaced with property syntax for better code clarity and idiomatic Apex"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<description>
			Private fields with public getter methods should be replaced with
			property syntax. Apex provides property syntax that is more concise and
			idiomatic than Java-style getter methods. Use property syntax instead of
			private fields with public getter methods.

			Version: 1.0.0
		</description>
		<priority>3</priority>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					//Method[
						ModifierNode[@Public = true()]
						and @ReturnType != 'void'
						and starts-with(@Image, 'get')
						and count(BlockStatement//ReturnStatement) = 1
						and BlockStatement//ReturnStatement/VariableExpression
						and lower-case(BlockStatement//ReturnStatement/VariableExpression/@Image) = lower-case(substring-after(@Image, 'get'))
						and not(BlockStatement//MethodCallExpression)
						and not(BlockStatement//IfBlockStatement)
						and not(BlockStatement//ForLoopStatement)
						and not(BlockStatement//WhileLoopStatement)
					]
					]]>
				</value>
			</property>
		</properties>
		<example>
			<![CDATA[
			// Violation: Private field with public getter
			public class MyClass {
			    private String name;
			    
			    public String getName() {  // ❌
			        return name;
			    }
			}
			
			// Valid: Use property syntax
			public class MyClass {
			    public String name { get; private set; }  // ✅
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Violation: Multiple trivial getters
			public class Account {
			    private String accountId;
			    private String accountName;
			    
			    public String getAccountId() {  // ❌
			        return accountId;
			    }
			    
			    public String getAccountName() {  // ❌
			        return accountName;
			    }
			}
			
			// Valid: Use property syntax for all
			public class Account {
			    public String accountId { get; private set; }  // ✅
			    public String accountName { get; private set; }  // ✅
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Valid: Getter with logic is allowed (not trivial)
			public class MyClass {
			    private String name;
			    
			    public String getName() {  // ✅ Has logic
			        return name != null ? name.toUpperCase() : '';
			    }
			}
			
			// Valid: Non-public getter is allowed
			public class MyClass {
			    private String name;
			    
			    private String getName() {  // ✅ Not public
			        return name;
			    }
			}
			]]>
		</example>
	</rule>
</ruleset>

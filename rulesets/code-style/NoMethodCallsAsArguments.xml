<?xml version="1.0" ?>
<ruleset
	name="Apex Code Style Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>Custom rules for Apex code style and formatting</description>
	<rule
		name="NoMethodCallsAsArguments"
		language="apex"
		message="Method calls should not be used directly as arguments. Extract the method call result to a variable first for better readability and debugging"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<description>
			Method calls should not be used directly as arguments to constructors, method calls, or
			expressions. Extract method calls to variables first for better readability, debugging,
			and to avoid potential side effects from multiple evaluations.
		</description>
		<priority>2</priority>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					//MethodCallExpression[
						(
							parent::MethodCallExpression
							or parent::NewObjectExpression
							or ancestor::MethodCallExpression[position() > 1]
							or ancestor::NewObjectExpression
						)
						and not(
							ancestor::VariableDeclaration[VariableExpression]
							or ancestor::AssignmentExpression[VariableExpression]
							or parent::VariableDeclaration
						)
					]
					|
					//NewObjectExpression[.//MethodCallExpression]/MethodCallExpression
					]]>
				</value>
			</property>
		</properties>
		<example>
			<![CDATA[
			// Violation: Method call as argument
			String result = processValue(getValue());
			
			// Valid: Extract method call to variable
			Integer value = getValue();
			String result = processValue(value);
			]]>
		</example>
	</rule>
</ruleset>

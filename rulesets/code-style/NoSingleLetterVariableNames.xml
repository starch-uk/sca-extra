<?xml version="1.0" ?>
<ruleset
	name="Apex Code Style Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>
		Custom rules for Apex code style (formatting, naming conventions, code
		style patterns)
	</description>
	<rule
		name="NoSingleLetterVariableNames"
		language="apex"
		message="Single-letter variable names are not allowed except for loop counters (i, c) or exception variables (e). Use descriptive names instead"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<description>
			Single-letter variable names are not allowed except for loop
			counters
			(i, c) or exception variables (e). Use descriptive names instead to improve
			code readability and make the code self-documenting. Single-letter names
			provide no context about the variable's purpose.
			
			To customize this rule, edit the variables at the beginning of the XPath
			expression:
			- $allowedLoopNames: Comma-separated list of allowed loop counter names
			(default: 'i,c')
			- $allowedExceptionNames: Comma-separated list of allowed exception
			variable names (default: 'e')

			Version: 1.0.0
		</description>
		<priority>2</priority>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					let $allowedLoopNames := 'i,c',
						$allowedExceptionNames := 'e'
					return (
						//VariableDeclaration[
							let $varName := @Image,
								$isInCatchBlock := exists(ancestor::CatchBlockStatement)
							return string-length($varName) = 1
							and (
								($isInCatchBlock and not(contains($allowedExceptionNames, $varName)))
								or (not($isInCatchBlock) and not(contains($allowedLoopNames, $varName)))
							)
						]
						|
						//CatchBlockStatement[
							let $varName := @VariableName
							return string-length($varName) = 1
							and not(contains($allowedExceptionNames, $varName))
						]
					)
					]]>
				</value>
			</property>
		</properties>
		<example>
			<![CDATA[
			// Violation: Single-letter variable names
			Integer x = 5;
			String s = 'test';
			Boolean b = true;
			
			// Valid: Descriptive names
			Integer index = 5;
			String status = 'test';
			Boolean isActive = true;
			]]>
		</example>
		<example>
			<![CDATA[
			// Valid: Loop counters (i, c)
			for (Integer i = 0; i < 10; i++) {
			    // ...
			}
			for (Integer c = 0; c < items.size(); c++) {
			    // ...
			}
			
			// Violation: Other single letters in loops
			for (Integer j = 0; j < 10; j++) {  // ❌ Use 'i' or 'c' instead
			    // ...
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Valid: Exception variable (e)
			try {
			    // ...
			} catch (Exception e) {
			    // ...
			}
			
			// Violation: Other single letters in catch blocks
			try {
			    // ...
			} catch (Exception x) {  // ❌ Use 'e' instead
			    // ...
			}
			]]>
		</example>
	</rule>
</ruleset>

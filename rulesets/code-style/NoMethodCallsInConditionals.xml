<?xml version="1.0" ?>
<ruleset
	name="Apex Code Style Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>Custom rules for Apex code style and formatting</description>
	<rule
		name="NoMethodCallsInConditionals"
		language="apex"
		message="Method calls should not be used directly in conditional expressions. Extract the method call result to a variable first to improve readability and avoid side effects"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<description>
			Method calls should not be used directly in conditional expressions.
			Extract method call results to variables first to improve readability,
			avoid potential side effects from multiple evaluations, and make debugging
			easier. This rule applies to if, else-if, for, for-each, switch, and ternary
			expressions. This rule does not apply to while or do-while loops.

			Version: 2.0.0
		</description>
		<priority>2</priority>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					//(
						IfBlockStatement
						| SwitchStatement
						| ForLoopStatement
						| TernaryExpression
					)[StandardCondition//MethodCallExpression]
					| //IfElseBlockStatement[
						IfBlockStatement/StandardCondition//MethodCallExpression
					]
					| //ForEachStatement[MethodCallExpression]
					]]>
				</value>
			</property>
		</properties>
		<example>
			<![CDATA[
			// Violation: Method call in if statement
			if (getValue() > 0) {
			    // ...
			}
			
			// Valid: Extract method call to variable
			Integer value = getValue();
			if (value > 0) {
			    // ...
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Violation: Method call in ternary expression
			String result = isValid() ? 'yes' : 'no';
			
			// Valid: Extract method call to variable
			Boolean valid = isValid();
			String result = valid ? 'yes' : 'no';
			]]>
		</example>
		<example>
			<![CDATA[
			// Violation: Method call in switch statement
			switch on getStatus() {
			    when 'active' { }
			}
			
			// Valid: Extract method call to variable
			String status = getStatus();
			switch on status {
			    when 'active' { }
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Violation: Method call in for-each loop collection
			for (String item : getItems()) {
			    // ...
			}
			
			// Valid: Extract method call to variable
			List<String> items = getItems();
			for (String item : items) {
			    // ...
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Valid: Method calls in while loops are allowed
			while (hasMoreItems()) {
			    // ...
			}
			]]>
		</example>
		<example>
			<![CDATA[
			// Valid: Method calls in do-while loops are allowed
			do {
			    // ...
			} while (hasMoreItems());
			]]>
		</example>
	</rule>
</ruleset>

<?xml version="1.0" ?>
<ruleset
	name="Apex Structure Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>
		Custom rules for Apex code structure and organization
	</description>
	<rule
		name="ClassesMustHaveMethods"
		language="apex"
		message="Classes, including inner classes, must have instance methods. Classes with only attributes and constructors are not allowed"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<description>
			Classes and inner classes that only contain attributes and
			constructors
			without any instance methods are not allowed. Classes should provide
			behavior, not just data. Add instance methods to provide behavior, or
			refactor to use a different approach such as using Map or a different data
			structure.
			
			To customize this rule, edit the variables at the beginning of the XPath
			expression:
			- $minFields: Minimum number of fields required (default: 1)
			- $minConstructors: Minimum number of constructors required (default: 1)
		</description>
		<priority>3</priority>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					let $minFields := 1,
						$minConstructors := 1
					return //UserClass[
						count(Field) >= $minFields
						and count(Method[@Constructor = true()]) >= $minConstructors
						and count(Method[@Constructor = false() and not(ModifierNode[@Static = true()])]) = 0
					]
					]]>
				</value>
			</property>
		</properties>
		<example>
			<![CDATA[
			// Violation: Class with only fields and constructor
			public class Parameter {
				public String name;
				public Integer value;
				
				public Parameter(String name, Integer value) {
					this.name = name;
					this.value = value;
				}
			}
			
			// Valid: Class with instance methods
			public class Parameter {
				public String name;
				public Integer value;
				
				public Parameter(String name, Integer value) {
					this.name = name;
					this.value = value;
				}
				
				public String toString() {
					return name + '=' + value;
				}
			}
			]]>
		</example>
	</rule>
</ruleset>

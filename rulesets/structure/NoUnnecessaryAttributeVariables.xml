<?xml version="1.0" ?>
<ruleset
	name="Apex Structure Rules"
	xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
>
	<description>Custom rules for Apex code structure and organization</description>
	<rule
		name="NoUnnecessaryAttributeVariables"
		language="apex"
		message="Variables that extract a single attribute from an object and are only used once should be inlined. This rule only applies to primitive types, not collections or object instances"
		class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
	>
		<priority>3</priority>
		<description>
			Variables that extract a single attribute from an object and are only used once should
			be
			inlined. This rule does not apply to collection types (List, Set, Map) or object/class
			instances, only primitive types. Inlining these variables reduces unnecessary indirection
			and improves code clarity.
		</description>
		<example>
			<![CDATA[
			// Violation: Variable used only once
			String name = account.Name;
			processName(name);
			
			// Valid: Inline the attribute access
			processName(account.Name);
			]]>
		</example>
		<properties>
			<property name="xpath">
				<value>
					<![CDATA[
					for $var in //VariableDeclaration[
                        VariableExpression[1]/ReferenceExpression
                        and (
                            @Type = 'String'
                            or @Type = 'Integer'
                            or @Type = 'Long'
                            or @Type = 'Double'
                            or @Type = 'Decimal'
                            or @Type = 'Boolean'
                            or @Type = 'Date'
                            or @Type = 'DateTime'
                            or @Type = 'Time'
                            or @Type = 'Id'
                            or @Type = 'Blob'
                        )
                        and VariableExpression[2]
                    ]
                    return if (
                        not($var/ancestor::Method//AssignmentExpression[
                            VariableExpression[@Image = $var/VariableExpression[2]/@Image]
                            and not(ancestor::VariableDeclaration[1] = $var)
                        ])
                        and count(
                            $var/ancestor::Method//VariableExpression[
                                @Image = $var/VariableExpression[2]/@Image
                                and not(ancestor::VariableDeclaration[1] = $var)
                            ]
                        ) = 1
                    ) then $var else ()
					]]>
				</value>
			</property>
		</properties>
	</rule>
</ruleset>
